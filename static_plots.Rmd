---
title: "working_final_plots"
author: "Joya Wheatfall-Melvin"
date: "2025-12-05"
output: html_document
---

### These are all static ggplots before adding highchart in ShinyApp

```{r setup, include=FALSE}
library(ggthemes)
library(dplyr)
library(tidyverse)
library(forcats)
library(scales)
library(ggthemes)
library(ggplot2)
library(treemapify)
library(dplyr)
library(plotly)

high_violation_2023 <- read_csv("low-wage-high-violation.csv", show_col_types = FALSE)

industry_pop <- read_csv("industry_pop.csv", show_col_types = FALSE)

knitr::opts_chunk$set(echo = TRUE)
```


### 1. Debt Types by Race ~ Line Chart 
- Credit Card Balances After Last Payment 
- Debt Secured by Primary Residence 
- Education Loans 
- Installment Loans 
- Other Debts 
- Total Debts
```{r}
# Load data
median_assets_debts <- read_csv("median_assets_debt.csv", show_col_types = FALSE)

# Filtering for all education loan debt by race (not ALL)
all_race_edu_debt <- median_assets_debts %>%
  filter(
    racecl4 != "All",
    metric_type == "Debt",
    metric == "Education Loans") %>%
  select(year, racecl4, median)

# Plot
  ggplot(all_race_edu_debt, aes(year, median, color = racecl4, group = racecl4)) + 
  geom_line(size = 1.5) + 
  geom_point(size = 2) +
  scale_x_continuous(breaks = c(2007, 2010, 2013, 2016, 2019, 2022)) + # Wanted the median connected with each year data point
  scale_y_continuous(labels = scales::label_dollar()) +
  theme_fivethirtyeight(base_size = 11, base_family = "Futura") +
  scale_color_manual(values = c("Black" = "#618825", "White" = "#052E2A",
                               "Hispanic" = "#4D8AB3", "Other" = "#64AFA7")) +
  labs(title = "Racial Disparities in Median Education Loan Debt, 2007–2022", 
       color = NULL, # Race legend title is unnecessary 
       caption = "Data Source: Black Wealth Data Center calculations from U.S. Federal Reserve, Survey of Consumer Finances (SCF) years from 2007 to 2022.\n'Other' group includes Asian, American Indian, Alaska Native, Native Hawaiian, Pacific Islander, and other races.") + 
  theme(plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5), 
        plot.caption.position = "plot")
```

```{r}
# Define the debt metrics
debt_metrics <- c("Credit Card Balances after Last Payment",
                  "Debt Secured by Primary Residence",
                  "Education Loans",
                  "Installment Loans",
                  "Other Debts",
                  "Total Debt")

# Filter for all debt metrics by race (not ALL)
all_race_debt <- median_assets_debts %>%
  filter(
    racecl4 != "All",
    metric_type == "Debt",
    metric %in% debt_metrics) %>%
  select(year, racecl4, median, metric)

# 1. Credit Card Balances
credit_card_plot <- all_race_debt %>%
  filter(metric == "Credit Card Balances after Last Payment") %>%
  ggplot(aes(year, median, color = racecl4, group = racecl4)) + 
  geom_line(size = 1.5) + 
  geom_point(size = 2) +
  scale_x_continuous(breaks = c(2007, 2010, 2013, 2016, 2019, 2022)) +
  scale_y_continuous(labels = scales::label_dollar()) +
  theme_fivethirtyeight(base_size = 11, base_family = "Futura") +
  scale_color_manual(values = c("Black" = "#618825", "White" = "#052E2A",
                               "Hispanic" = "#4D8AB3", "Other" = "#64AFA7")) +
  labs(title = "Racial Disparities in Median Credit Card Balances after Last Payment, 2007–2022", 
       color = NULL,
       caption = "Data Source: Black Wealth Data Center calculations from U.S. Federal Reserve, Survey of Consumer Finances (SCF) years from 2007 to 2022.\n'Other' group includes Asian, American Indian, Alaska Native, Native Hawaiian, Pacific Islander, and other races.") + 
  theme(plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5), 
        plot.caption.position = "plot")

# 2. Debt Secured by Primary Residence
primary_residence_plot <- all_race_debt %>%
  filter(metric == "Debt Secured by Primary Residence") %>%
  ggplot(aes(year, median, color = racecl4, group = racecl4)) + 
  geom_line(size = 1.5) + 
  geom_point(size = 2) +
  scale_x_continuous(breaks = c(2007, 2010, 2013, 2016, 2019, 2022)) +
  scale_y_continuous(labels = scales::label_dollar()) +
  theme_fivethirtyeight(base_size = 11, base_family = "Futura") +
  scale_color_manual(values = c("Black" = "#618825", "White" = "#052E2A",
                               "Hispanic" = "#4D8AB3", "Other" = "#64AFA7")) +
  labs(title = "Racial Disparities in Median Debt Secured by Primary Residence, 2007–2022", 
       color = NULL,
       caption = "Data Source: Black Wealth Data Center calculations from U.S. Federal Reserve, Survey of Consumer Finances (SCF) years from 2007 to 2022.\n'Other' group includes Asian, American Indian, Alaska Native, Native Hawaiian, Pacific Islander, and other races.") +  
  theme(plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5), 
        plot.caption.position = "plot")

# 3. Education Loans
education_plot <- all_race_debt %>%
  filter(metric == "Education Loans") %>%
  ggplot(aes(year, median, color = racecl4, group = racecl4)) + 
  geom_line(size = 1.5) + 
  geom_point(size = 2) +
  scale_x_continuous(breaks = c(2007, 2010, 2013, 2016, 2019, 2022)) +
  scale_y_continuous(labels = scales::label_dollar()) +
  theme_fivethirtyeight(base_size = 11, base_family = "Futura") +
  scale_color_manual(values = c("Black" = "#618825", "White" = "#052E2A",
                               "Hispanic" = "#4D8AB3", "Other" = "#64AFA7")) +
  labs(title = "Racial Disparities in Median Education Loan Debt, 2007–2022", 
       color = NULL,
       caption = "Data Source: Black Wealth Data Center calculations from U.S. Federal Reserve, Survey of Consumer Finances (SCF) years from 2007 to 2022.\n'Other' group includes Asian, American Indian, Alaska Native, Native Hawaiian, Pacific Islander, and other races.") + 
  theme(plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5), 
        plot.caption.position = "plot")

# 4. Installment Loans
installment_plot <- all_race_debt %>%
  filter(metric == "Installment Loans") %>%
  ggplot(aes(year, median, color = racecl4, group = racecl4)) + 
  geom_line(size = 1.5) + 
  geom_point(size = 2) +
  scale_x_continuous(breaks = c(2007, 2010, 2013, 2016, 2019, 2022)) +
  scale_y_continuous(labels = scales::label_dollar()) +
  theme_fivethirtyeight(base_size = 11, base_family = "Futura") +
  scale_color_manual(values = c("Black" = "#618825", "White" = "#052E2A",
                               "Hispanic" = "#4D8AB3", "Other" = "#64AFA7")) +
  labs(title = "Racial Disparities in Median Installment Loans, 2007–2022", 
       color = NULL,
       caption = "Data Source: Black Wealth Data Center calculations from U.S. Federal Reserve, Survey of Consumer Finances (SCF) years from 2007 to 2022.\n'Other' group includes Asian, American Indian, Alaska Native, Native Hawaiian, Pacific Islander, and other races.") + 
  theme(plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5), 
        plot.caption.position = "plot")

# 5. Other Debts
other_debts_plot <- all_race_debt %>%
  filter(metric == "Other Debts") %>%
  ggplot(aes(year, median, color = racecl4, group = racecl4)) + 
  geom_line(size = 1.5) + 
  geom_point(size = 2) +
  scale_x_continuous(breaks = c(2007, 2010, 2013, 2016, 2019, 2022)) +
  scale_y_continuous(labels = scales::label_dollar()) +
  theme_fivethirtyeight(base_size = 11, base_family = "Futura") +
  scale_color_manual(values = c("Black" = "#618825", "White" = "#052E2A",
                               "Hispanic" = "#4D8AB3", "Other" = "#64AFA7")) +
  labs(title = "Racial Disparities in Median Other Debts, 2007–2022", 
       color = NULL,
       caption = "Data Source: Black Wealth Data Center calculations from U.S. Federal Reserve, Survey of Consumer Finances (SCF) years from 2007 to 2022.\n'Other' group includes Asian, American Indian, Alaska Native, Native Hawaiian, Pacific Islander, and other races.") + 
  theme(plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5), 
        plot.caption.position = "plot")

# 6. Total Debt
total_debt_plot <- all_race_debt %>%
  filter(metric == "Total Debt") %>%
  ggplot(aes(year, median, color = racecl4, group = racecl4)) + 
  geom_line(size = 1.5) + 
  geom_point(size = 2) +
  scale_x_continuous(breaks = c(2007, 2010, 2013, 2016, 2019, 2022)) +
  scale_y_continuous(labels = scales::label_dollar()) +
  theme_fivethirtyeight(base_size = 11, base_family = "Futura") +
  scale_color_manual(values = c("Black" = "#618825", "White" = "#052E2A",
                               "Hispanic" = "#4D8AB3", "Other" = "#64AFA7")) +
  labs(title = "Racial Disparities in Median Total Debt, 2007–2022", 
       color = NULL,
       caption = "Data Source: Black Wealth Data Center calculations from U.S. Federal Reserve, Survey of Consumer Finances (SCF) years from 2007 to 2022.\n'Other' group includes Asian, American Indian, Alaska Native, Native Hawaiian, Pacific Islander, and other races.") + 
  theme(plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5), 
        plot.caption.position = "plot")

# Display all plots
credit_card_plot
primary_residence_plot
education_plot
installment_plot
other_debts_plot
total_debt_plot
```
```{r}
# Save all plots
ggsave("plots/credit_card_debt.png", 
       plot = credit_card_plot, 
       width = 10, 
       height = 5, 
       dpi = 300)

ggsave("plots/primary_residence_debt.png", 
       plot = primary_residence_plot, 
       width = 10, 
       height = 5, 
       dpi = 300)

ggsave("plots/education_loan_debt.png", 
       plot = education_plot, 
       width = 10, 
       height = 5, 
       dpi = 300)

ggsave("plots/installment_loan_debt.png", 
       plot = installment_plot, 
       width = 10, 
       height = 5, 
       dpi = 300)

ggsave("plots/other_debts.png", 
       plot = other_debts_plot, 
       width = 10, 
       height = 5, 
       dpi = 300)

ggsave("plots/total_debt.png", 
       plot = total_debt_plot, 
       width = 10, 
       height = 5, 
       dpi = 300)
```


### 2. 2023 Low-Wage, High-Violation Industries ~ Horizontal Bar Chart 
- Race Composition by Low-Wage, High-Violation Industries 

```{r}
high_violation_2023 <- read_csv("low-wage-high-violation.csv", show_col_types = FALSE)

industry_pop <- read_csv("industry_pop.csv", show_col_types = FALSE)
```

```{r}
## 2023 Top most low wage, high violation industries in Healthcare, Food Services, and Construction
## BWC only has the acs_year of 2023, but also the cps_year of 2024 -> which one should we use? Using 2023 top 3 industries, but can change to 2024 top 3 industries


# Clean and prepare the data for plotting
violations_clean <- high_violation_2023 %>%
  select(`Low Wage, High Violation Industries`, `...7`) %>%
  rename(industry_label = `Low Wage, High Violation Industries`,
         BackWages = `...7`) %>%
  # Remove the header row if it exists
  filter(industry_label != "Low Wage, High Violation Industries") %>%
  # Convert BackWages to numeric (remove $ and commas)
  mutate(BackWages = as.numeric(gsub("\\$|,", "", BackWages))) %>%
  # Sort by BackWages in descending order
  arrange(desc(BackWages))

# View the cleaned data
head(violations_clean)
```

```{r fig.width=10, fig.height=5}
# Plot
top3_backwages_plot <- violations_clean %>%
  mutate(rank = row_number(desc(BackWages)),
         color_group = ifelse(rank <= 3, "Top 3", "Other")) %>%
  ggplot(aes(x = fct_reorder(industry_label, BackWages), y = BackWages, fill = color_group)) + 
  geom_bar(stat = "identity") +
  coord_flip() +
  scale_y_continuous(labels = label_dollar()) +
  scale_fill_manual(values = c("Top 3" = "#4D8AB3", "Other" = "darkgrey")) +
  theme_fivethirtyeight(base_size = 11, base_family = "Futura") +
  labs(title = "Back Wages Owed in Low-Wage, High-Violation Industries (2023)",
       caption = "Data Source, U.S. Department of Labor, Wage and Hour Division, 2023",
       x = "Industry",
       y = "Back Wages Awarded") + 
  theme(plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5), 
        plot.caption.position = "plot",
        legend.position = "none")  

top3_backwages_plot

```
```{r}
ggsave("plots/top3_backwages_plot.png", 
       plot = top3_backwages_plot, 
       width = 10, 
       height = 5, 
       dpi = 300)
```

### 3. Race Composition by Top 3 Low-Wage, High-Violation Industries ~ Vertical Bar Chart

```{r}
# Filter for the top 5 industries
top_3_industries <- industry_pop %>%
  filter(sub_occupation_2 == "all") %>%
  filter(
    (occupation == "Service occupations" & sub_occupation_1 == "Healthcare support occupations") |
    (occupation == "Service occupations" & sub_occupation_1 == "Food preparation and serving related occupations") |
    (occupation == "Natural resources, construction, and maintenance occupations" & sub_occupation_1 == "Construction and extraction occupations")) %>%
  group_by(cps_year) %>%
  mutate(industry_label = case_when(
    sub_occupation_1 == "Healthcare support occupations" ~ "Health Care",
    sub_occupation_1 == "Food preparation and serving related occupations" ~ "Food Services",
    sub_occupation_1 == "Construction and extraction occupations" ~ "Construction",
    TRUE ~ NA_character_
  ))

head(top_3_industries)
```


```{r}
# Prepare data for treemap: industry area = BackWages, internal race tiles = per-100 shares
library(treemapify)

# 2. Get top 5 industries by BackWages
top3_backwages <- violations_clean %>%
  arrange(desc(BackWages)) %>%
  slice_head(n = 3)

top3_names <- top3_backwages$industry_label

# 4. Join BackWages to industry_pop data
df_treemap_prep <- top_3_industries %>%
  left_join(top3_backwages, by = "industry_label") %>%
  select(industry_label, BackWages,
         number_employed_white_per_100,
         number_employed_black_per_100,
         number_employed_asian_per_100,
         number_employed_hispanic_per_100) %>%
  distinct()
```

```{r}
# Use raw per-100 values for tile areas (not proportions)
df_treemap <- df_treemap_prep %>%
  pivot_longer(cols = ends_with("_per_100"),
               names_to = "race",
               values_to = "per_100") %>%
  mutate(race = case_when(
    race == "number_employed_white_per_100" ~ "White",
    race == "number_employed_black_per_100" ~ "Black",
    race == "number_employed_asian_per_100" ~ "Asian",
    race == "number_employed_hispanic_per_100" ~ "Hispanic",
    TRUE ~ race
  )) %>%
  mutate(
    # Tile area = BackWages × raw per-100 value (NOT divided by total)
    tile_area = BackWages * per_100,
    label_text = str_c(
      "Race / Ethnicity: ", race, "\n",
      "Total Population Employed per 100 People: ", per_100
    )
  ) %>%
  mutate(industry_label = factor(industry_label, levels = top_3_industries),
         race = factor(race, levels = c("Black", "White", "Hispanic", "Asian")))

```

Was orignially a treemap but changed to vertical bar chart. 

```{r}
# Prepare data for treemap
library(treemapify)

# Get top 3 industries by BackWages
top3_backwages <- violations_clean %>%
  arrange(desc(BackWages)) %>%
  slice_head(n = 3)

# Join BackWages to industry_pop data and pivot to long format
df_treemap <- top_3_industries %>%
  left_join(top3_backwages, by = "industry_label") %>%
  select(industry_label, BackWages,
         number_employed_white_per_100,
         number_employed_black_per_100,
         number_employed_asian_per_100,
         number_employed_hispanic_per_100) %>%
  distinct() %>%
  pivot_longer(cols = ends_with("_per_100"),
               names_to = "race",
               values_to = "per_100") %>%
  mutate(
    race = case_when(
      race == "number_employed_white_per_100" ~ "White",
      race == "number_employed_black_per_100" ~ "Black",
      race == "number_employed_asian_per_100" ~ "Asian",
      race == "number_employed_hispanic_per_100" ~ "Hispanic"
    ),
    race = factor(race, levels = c("Black", "White", "Hispanic", "Asian")),
    tile_area = BackWages * per_100,
    race_share = per_100 / sum(per_100),  # Calculate race_share here
    label_text = paste0("Race / Ethnicity: ", race, "\n",
                       "Total Population Employed per 100 People: ", per_100)
  ) %>%
  group_by(industry_label) %>%
  mutate(race_share = per_100 / sum(per_100)) %>%  # Proper calculation by industry
  ungroup()

# Create treemap
final_treemap <- ggplot(df_treemap, aes(area = tile_area, fill = race, subgroup = industry_label)) +
  geom_treemap(colour = "lightgrey", size = 1) +
  geom_treemap_subgroup_border(colour = "lightgrey", size = 3) +
  geom_treemap_text(aes(label = paste0(race, "\n", round(per_100, 1))),
                    colour = "white",
                    place = "bottomleft", grow = FALSE,
                    size = 10,
                    min.size = 2) +
  geom_treemap_subgroup_text(aes(label = paste0(industry_label, "\n", 
                                                scales::dollar(BackWages, scale = 1e-6, suffix = "M"))),
                            place = "topleft",
                            colour = "white", fontface = "bold",
                            reflow = TRUE,
                            size = 14,
                            min.size = 5) + 
  scale_fill_manual(values = c("Black" = "#618825", "White" = "#052E2A",
                               "Hispanic" = "#4D8AB3", "Asian" = "#64AFA7")) +
  labs(title = "Racial Composition of Workers in Low-Wage, High-Violation Industries (2023)",
       subtitle = "Total Population Employed per 100 People",
       caption = "Data Source: Black Wealth Data Center calculations from Bureau of Labor Statistics,\nLabor Force Statistics from the Current Population Survey, 2023. 2023 is the most recent table publication year.",
       fill = "Race") +
  theme_fivethirtyeight(base_family = "Futura") +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
        plot.subtitle = element_text(face = "italic", size = 10, hjust = 0.5),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5), 
        plot.caption.position = "plot")

final_treemap
```

#### Tree Map w/ Percentages 
```{r}
# Added proportions (percentages)
final_treemappct <- ggplot(df_treemap, aes(area = tile_area, fill = race, subgroup = industry_label, text = label_text)) +
  geom_treemap(colour = "lightgrey", size = 1) +
  geom_treemap_subgroup_border(colour = "lightgrey", size = 3) +
  
  # Small fixed-size race labels inside each race tile
  geom_treemap_text(aes(label = paste0(race, "\n", scales::percent(race_share, accuracy = 0.1))),
                    colour = "white",
                    place = "bottomleft", grow = FALSE,
                    size = 10,
                    min.size = 2) +
  
  # Standardized industry label + BackWages inside each industry box
geom_treemap_subgroup_text(aes(label = paste0(industry_label, "\n", scales::dollar(BackWages, scale = 1e-6, suffix = "M"))),
                           place = "topleft",
                           colour = "white", fontface = "bold",
                           reflow = TRUE,
                           size = 14,
                           min.size = 5) + 
  
  scale_fill_manual(values = c("Black" = "#618825", "White" = "#052E2A",
                               "Hispanic" = "#4D8AB3", "Asian" = "#64AFA7")) +
  labs(title = "Racial Composition of Workers in Low-Wage, High-Violation Industries (2023)",
       caption = "Data Source: Black Wealth Data Center calculations from Bureau of Labor Statistics,\n Labor Force Statistics from the Current Population Survey, 2023. 2023 is the most recent table publication year.",
       fill = "Race") +
  theme_fivethirtyeight(base_family = "Futura") +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5), 
        plot.caption.position = "plot")

# Show the plot
final_treemappct

```


```{r}
ggsave("plots/treemap_pct.png", 
       plot = final_treemappct,
       width = 10, 
       height = 7,
       dpi = 300)
```

```{r fig.width=10, fig.height=10}
wage_stacked_bar <- 
  ggplot(df_treemap, aes(x = industry_label,
                         y = BackWages * race_share,
                         fill = race)) +
  geom_bar(stat = "identity", position = "stack", width = 0.5) + 
  geom_text(aes(label = paste0(race, "\n", scales::percent(race_share, accuracy = 0.1))),
          position = position_stack(vjust = 0.5),
          colour = "white", size = 4) +
  scale_fill_manual(values = c("Black" = "#618825", "White" = "#052E2A",
                               "Hispanic" = "#4D8AB3", "Asian" = "#64AFA7")) +
  scale_y_continuous(labels = label_dollar(scale = 1e-6, suffix = "M")) +
  labs(
    title = "Back Wages (Millions) in Low-Wage, High-Violation Industries by Race (2023)",
    x = NULL,
    y = "Back Wages (Millions)",
    caption = "Data Source: Black Wealth Data Center calculations from Bureau of Labor Statistics,\n Labor Force Statistics from the Current Population Survey, 2023. 2023 is the most recent table publication year.",
    fill = "Race / Ethnicity") + 
  theme_fivethirtyeight(base_family = "Futura", base_size = 11) +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.title.position = "plot",
        plot.caption = element_text(size = 10, hjust = 0.5), 
        plot.caption.position = "plot",
        axis.text.x = element_text(size = 14),
        axis.text.y = element_text(size = 14))
  
wage_stacked_bar

```

```{r}
ggsave("plots/wage_stacked_bar.png", 
       plot = wage_stacked_bar, 
       width = 10, 
       height = 10, 
       dpi = 300)
```

### 3. Federal Rollbacks ~ Line Chart 

```{r}
# All 20 yrs over data
bw_unemployment <- read_csv("bw_unemployment.csv", show_col_types = FALSE)
avg_unemployment <- read_csv("avg_unemployment.csv", show_col_types = FALSE)
ww_unemployment <- read_csv("ww_unemployment.csv", show_col_types = FALSE)

```


```{r fig.width=12, fig.height=6}
# Prepare the data
unemployment_data <- bind_rows(
  avg_unemployment %>% mutate(Group = "Average"),
  bw_unemployment %>% mutate(Group = "Black Women")
) %>%
  mutate(
    Month_Num = as.numeric(gsub("M", "", Period)),
    Date = as.Date(paste(Year, Month_Num, "01", sep = "-"))
  )

# Create the line graph
unemployment_plot <- ggplot(unemployment_data, aes(x = Date, y = Value, color = Group, group = Group)) +
  geom_line(linewidth = 1) +
  geom_text(data = unemployment_data %>% filter(Year == 2025, Period == "M09"),
            aes(label = paste0(round(Value, 1), "%")),
            hjust = -0.1, fontface = "bold", size = 4, show.legend = FALSE) +
  scale_color_manual(values = c("Average" = "#639E02", "Black Women" = "#052E2A")) +
  scale_x_date(date_breaks = "12 months", date_labels = "%b %Y") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(
    title = "Black Women's Unemployment Rate vs. National Average (2020 - 2025)",
    x = NULL,
    y = "Unemployment Rate (%)",
    color = NULL,
    caption = "Data Source: Bureau of Labor Statistics, Current Population Survey (Seasonally Adjusted Rates for Workers 20 and Older)"
  ) +
  theme_fivethirtyeight(base_family = "Futura") +
  theme(
    legend.position = "top",
    plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
    plot.caption = element_text(face = "italic", size = 8, hjust = 0.5)
  )

unemployment_plot
```

```{r}
ggsave("plots/bw_unemployment.png", 
       plot = unemployment_plot, 
       width = 12, 
       height = 6, 
       dpi = 300)
```

### All demographics/sex unemployment 
```{r}
# Load additional unemployment data for comprehensive comparison
bm_unemployment <- read_csv("bm_unemployment.csv", show_col_types = FALSE)
black_unemployment <- read_csv("black_unemployment.csv", show_col_types = FALSE)
hw_unemployment <- read_csv("hw_unemployment.csv", show_col_types = FALSE)
hm_unemployment <- read_csv("hm_unemployment.csv", show_col_types = FALSE)
hispanic_unemployment <- read_csv("hispanic_unemployment.csv", show_col_types = FALSE)
wm_unemployment <- read_csv("wm_unemployment.csv", show_col_types = FALSE)
white_unemployment <- read_csv("white_unemployment.csv", show_col_types = FALSE)
bw_unemployment <- read_csv("bw_unemployment.csv", show_col_types = FALSE)
avg_unemployment <- read_csv("avg_unemployment.csv", show_col_types = FALSE)
ww_unemployment <- read_csv("ww_unemployment.csv", show_col_types = FALSE)
```

```{r fig.width=14, fig.height=8}
# Combine all unemployment data
all_unemployment_data <- bind_rows(
  avg_unemployment %>% mutate(Group = "National Average"),
  bw_unemployment %>% mutate(Group = "Black Women"),
  bm_unemployment %>% mutate(Group = "Black Men"),
  black_unemployment %>% mutate(Group = "Black Overall"),
  ww_unemployment %>% mutate(Group = "White Women"),
  wm_unemployment %>% mutate(Group = "White Men"),
  white_unemployment %>% mutate(Group = "White Overall"),
  hw_unemployment %>% mutate(Group = "Hispanic Women"),
  hm_unemployment %>% mutate(Group = "Hispanic Men"),
  hispanic_unemployment %>% mutate(Group = "Hispanic Overall")
) %>%
  mutate(
    Month_Num = as.numeric(gsub("M", "", Period)),
    Date = as.Date(paste(Year, Month_Num, "01", sep = "-"))
  )

# Define color palette for all demographics
unemployment_colors <- c(
  "National Average" = "#000000",
  "Black Women" = "#618825",
  "Black Men" = "#7BA840",
  "Black Overall" = "#96C85B",
  "White Women" = "#052E2A",
  "White Men" = "#0A4A45",
  "White Overall" = "#0F6660",
  "Hispanic Women" = "#4D8AB3",
  "Hispanic Men" = "#6AA3C8",
  "Hispanic Overall" = "#87BCDD"
)

# Create comprehensive line graph
unemployment_plot_all <- ggplot(all_unemployment_data, aes(x = Date, y = Value, color = Group, group = Group)) +
  geom_line(linewidth = 1) +
  geom_text(data = all_unemployment_data %>% filter(Year == 2025, Period == "M09"),
            aes(label = paste0(round(Value, 1), "%")),
            hjust = -0.1, fontface = "bold", size = 3, show.legend = FALSE) +
  scale_color_manual(values = unemployment_colors) +
  scale_x_date(date_breaks = "12 months", date_labels = "%Y", 
               limits = c(min(all_unemployment_data$Date), as.Date("2025-11-01"))) +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(
    title = "Unemployment Rate Comparison by Demographics (2020 - 2025)",
    x = NULL,
    y = "Unemployment Rate (%)",
    color = NULL,
    caption = "Data Source: Bureau of Labor Statistics, Current Population Survey (Seasonally Adjusted Rates for Workers 20 and Older)"
  ) +
  theme_fivethirtyeight(base_family = "Futura") +
  theme(
    legend.position = "bottom",
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.caption = element_text(face = "italic", size = 8, hjust = 0.5),
    plot.margin = margin(10, 80, 10, 10)
  )

unemployment_plot_all
```

```{r}
ggsave("plots/all_demographics_unemployment.png", 
       plot = unemployment_plot_all, 
       width = 14, 
       height = 8, 
       dpi = 300)
```

### Maps
```{r}
library(sf)
library(tigris)

usmap <- states()
```

# Post 4a: Black population by Geography

```{r}
# Load health insurance data and population data
pop_data <- read_csv("pop_by_state.csv", show_col_types = FALSE)

# Filter pop_data to have state black pop (pop_total, pop_black_alone, pct_black_alone, median_income_black_alone)
blk_state_pop <- pop_data %>%
  filter(geo_level == "state") %>%
  select(state_name, pop_total, pop_black_alone, 
         pct_black_alone, median_income_black_alone, quartiles_pct_black_alone)


# Prepare map data for Black population quartiles
blk_quartile_map_data <- left_join(usmap, blk_state_pop, by = c("NAME" = "state_name")) %>%
  shift_geometry() %>%
  filter(STATEFP <= 56) %>%
  mutate(quartiles_pct_black_alone = factor(quartiles_pct_black_alone, levels = c(
    "Top 25% of geographies", 
    "51-75% of geographies",
    "26-50% of geographies",
    "Bottom 25% of geographies"
  )))

# Create the Black population quartile map
black_quartile_map <- ggplot(blk_quartile_map_data) +
  geom_sf(aes(fill = quartiles_pct_black_alone), size = 0.25, color = "white") +
  scale_fill_manual(
    values = c(
      "Top 25% of geographies" = "#cb181d",
      "51-75% of geographies" = "#fb6a4a",  
      "26-50% of geographies" = "#fcae91", 
      "Bottom 25% of geographies" = "#fee5d9"      
    ),
    name = "Black Population\nQuartile",
    na.value = "grey90"
  ) +
  theme_minimal(base_size = 14, base_family = "sans") +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5, face = "italic"),
    plot.caption = element_text(size = 10, hjust = 0.5, face = "italic"),
    legend.title = element_text(face = "bold", size = 12),
    legend.text = element_text(size = 10),
    legend.position = "right",
    panel.grid = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank()
  ) +
  labs(
    title = "Black Population Distribution by State",
    subtitle = "States ranked by percentage of Black residents (quartiles)",
    caption = "Data Source: Black Wealth Data Center calculations from U.S. Census Bureau, 2023"
  )

black_quartile_map

```

```{r}
ggsave("plots/black_quartile_map.png", 
       plot = black_quartile_map, 
       width = 12, 
       height = 8, 
       dpi = 300)
```

## Post 4b: 2024 Right to Work states on a map
"States with RTW laws limiting worker power: States with statutory restrictions on all workers' collective bargaining rights due to so-called "right-to-work" laws"
"From https://www.epi.org/blog/data-show-anti-union-right-to-work-laws-damage-state-economies-as-michigans-repeal-takes-effect-new-hampshire-should-continue-to-reject-right-to-work-legislation/#100-100"

"State"	"“Right to work”"
"Alaska"	"Non-RTW"
"California"	"Non-RTW"
"Colorado"	"Non-RTW"
"Connecticut"	"Non-RTW"
"Delaware"	"Non-RTW"
"District of Columbia"	"Non-RTW"
"Hawaii"	"Non-RTW"
"Illinois"	"Non-RTW"
"Kansas"	"Pre-2010 RTW"
"Maine"	"Non-RTW"
"Maryland"	"Non-RTW"
"Massachusetts"	"Non-RTW"
"Minnesota"	"Non-RTW"
"Missouri"	"Non-RTW"
"Montana"	"Non-RTW"
"New Hampshire"	"Non-RTW"
"New Jersey"	"Non-RTW"
"New Mexico"	"Non-RTW"
"New York"	"Non-RTW"
"Ohio"	"Non-RTW"
"Oregon"	"Non-RTW"
"Pennsylvania"	"Non-RTW"
"Rhode Island"	"Non-RTW"
"Vermont"	"Non-RTW"
"Washington"	"Non-RTW"
"Alabama"	"Pre-2010 RTW"
"Arizona"	"Pre-2010 RTW"
"Arkansas"	"Pre-2010 RTW"
"Florida"	"Pre-2010 RTW"
"Georgia"	"Pre-2010 RTW"
"Idaho"	"Pre-2010 RTW"
"Iowa"	"Pre-2010 RTW"
"Louisiana"	"Pre-2010 RTW"
"Mississippi"	"Pre-2010 RTW"
"Nebraska"	"Pre-2010 RTW"
"Nevada"	"Pre-2010 RTW"
"North Carolina"	"Pre-2010 RTW"
"North Dakota"	"Pre-2010 RTW"
"Oklahoma"	"Pre-2010 RTW"
"South Carolina"	"Pre-2010 RTW"
"South Dakota"	"Pre-2010 RTW"
"Tennessee"	"Pre-2010 RTW"
"Texas"	"Pre-2010 RTW"
"Utah"	"Pre-2010 RTW"
"Virginia"	"Pre-2010 RTW"
"Wyoming"	"Pre-2010 RTW"
"Indiana"	"Post-2010 RTW"
"Kentucky"	"Post-2010 RTW"
"Michigan"	"Post-2010 RTW"
"West Virginia"	"Post-2010 RTW"
"Wisconsin"	"Post-2010 RTW"

"Notes: † Michigan enacted RTW in 2013, then in 2023 became the first state in nearly 60 years to repeal a RTW law. This change took effect February 13, 2024. "
"Source: Author's analysis of "Right-to-Work States," National Conference of State Legislatures. "

```{r}
# Create Right to Work dataframe
# Highlight Michigan
rtw_data <- tibble(
  State = c("Alaska", "California", "Colorado", "Connecticut", "Delaware", 
            "District of Columbia", "Hawaii", "Illinois", "Kansas", "Maine", 
            "Maryland", "Massachusetts", "Minnesota", "Missouri", "Montana", 
            "New Hampshire", "New Jersey", "New Mexico", "New York", "Ohio", 
            "Oregon", "Pennsylvania", "Rhode Island", "Vermont", "Washington",
            "Alabama", "Arizona", "Arkansas", "Florida", "Georgia", "Idaho", 
            "Iowa", "Louisiana", "Mississippi", "Nebraska", "Nevada", 
            "North Carolina", "North Dakota", "Oklahoma", "South Carolina", 
            "South Dakota", "Tennessee", "Texas", "Utah", "Virginia", "Wyoming",
            "Indiana", "Kentucky", "Michigan", "West Virginia", "Wisconsin"),
  RTW_Status = c(rep("Non-RTW", 25),
                 rep("Pre-2010 RTW", 21),
                 rep("Post-2010 RTW", 5))
)

rtw_data$RTW_Status <- rtw_data$RTW_Status != "Non-RTW"

head(rtw_data)
```

```{r}
# Prepare RTW map data
rtw_map_data <- left_join(usmap, rtw_data, by = c("NAME" = "State")) %>%
  shift_geometry() %>%
  filter(STATEFP <= 56) %>%
  mutate(RTW_Status = ifelse(RTW_Status, "RTW", "Non-RTW")) %>%
  mutate(RTW_Status = factor(RTW_Status, levels = c("Non-RTW", "RTW")))
```


```{r}
# Create the RTW map
rtw_map <- ggplot(rtw_map_data) +
  geom_sf(aes(fill = RTW_Status), size = 0.25, color = "lightgrey") +
  scale_fill_manual(
    values = c(
      "Non-RTW" = "beige",           # Blue for Non-RTW
      "RTW" = "#7BA840"      # Red for Post-2010
    ),
    name = "RTW Status"
  ) +
  theme_minimal(base_size = 14, base_family = "futura") +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5, face = "italic"),
    plot.caption = element_text(size = 10, hjust = 0.5, face = "italic"),
    legend.title = element_text(face = "bold", size = 12),
    legend.text = element_text(size = 10),
    legend.position = "right",
    panel.grid = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank()
  ) +
  labs(
    title = "Right-to-Work States in the United States",
    subtitle = "States with statutory restrictions on workers' collective bargaining rights",
    caption = "Data Source: National Conference of State Legislatures | Note: Michigan repealed RTW in 2024"
  )

rtw_map
```

```{r}
ggsave("plots/rtw_map_2020.png", 
       plot = rtw_map, 
       width = 12, 
       height = 8, 
       dpi = 300)
```


## Post 4c: 2020 Minimum Tipped Wage - Black workers are overrepresented in states with low or no minimum wage. States with no minimum wage laws are disproportionately former slave states.

```{r}
minimum_wage_data <- read_csv("minimum_wage_data.csv", show_col_types = FALSE)
```

```{r}
# Prepare Minimum Wage Map Data (2020)

min_wage_2020 <- minimum_wage_data %>%
  filter(Year == 2020)

min_wage_map_data <- left_join(usmap, min_wage_2020, by = c("NAME" = "State")) %>%
  shift_geometry() %>%
  filter(STATEFP <= 56) %>%
  mutate(wage_category = case_when(
    State.Minimum.Wage <= 7.25 ~ "Federal ($7.25 or less)",
    State.Minimum.Wage > 7.25 & State.Minimum.Wage < 10 ~ "$7.26 - $9.99",
    State.Minimum.Wage >= 10 & State.Minimum.Wage < 12 ~ "$10.00 - $11.99",
    State.Minimum.Wage >= 12 ~ "$12.00 or Higher"
  )) %>%
  mutate(wage_category = factor(wage_category, levels = c(
    "Federal ($7.25 or less)",
    "$7.26 - $9.99",
    "$10.00 - $11.99",
    "$12.00 or Higher"
  )))
```


```{r}

#"Average" = "#639E02", "Black Women" = "#052E2A""

# Create the map
min_wage_map <- ggplot(min_wage_map_data) +
  geom_sf(aes(fill = wage_category), size = 0.25, color = "lightgrey") +
  scale_fill_manual(
    values = c(
      "Federal ($7.25 or less)" = "#052E2A",    # Darkest Green
      "$7.26 - $9.99" = "#238b45",
      "$10.00 - $11.99" = "#74c476",
      "$12.00 or Higher" = "#c7e9c0"            # Lightest Green
    ),
    name = "Minimum Wage"
  ) +
  theme_minimal(base_size = 14, base_family = "sans") +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5, face = "italic"),
    plot.caption = element_text(size = 10, hjust = 0.5, face = "italic"),
    legend.title = element_text(face = "bold", size = 14),
    legend.text = element_text(size = 12),
    panel.grid = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank()
  ) +
  labs(
    title = "2020 State Minimum Wage",
    subtitle = "Lighter colors indicate higher minimum wage, darker colors indicate lower minimum wage.",
    caption = "Data Source: U.S. Department of Labor, 2020 State Minimum Wage Rates",
    fill = "Minimum Wage"
  )

min_wage_map
```

```{r}
ggsave("plots/min_wage_map_2020.png", 
       plot = min_wage_map, 
       width = 12, 
       height = 8, 
       dpi = 300)
```

## Post 4c: 2023 Black Median Income by State 

```{r}
# Load population data
pop_data <- read_csv("pop_by_state.csv", show_col_types = FALSE)
```

```{r}
# Filter pop_data to have state black pop (pop_total, pop_black_alone, pct_black_alone, median_income_black_alone)
blk_state_pop <- pop_data %>%
  filter(geo_level == "state") %>%
  select(state_name, pop_total, pop_black_alone, 
         pct_black_alone, median_income_black_alone, quartiles_pct_black_alone)
```

```{r}
# Prepare income map
blk_income_map_data <- left_join(usmap, blk_state_pop, by = c("NAME" = "state_name")) %>%
  shift_geometry() %>%
  filter(STATEFP <= 56) 
```

```{r}

# Create the Black median income map
black_income_map <- ggplot(blk_income_map_data) +
  geom_sf(aes(fill = median_income_black_alone), size = 0.25, color = "white") +
  scale_fill_gradient2(
    low = "#d73027",           # Red for low income
    mid = "#ffffbf",           # Yellow for mid income
    high = "#1a9850",          # Green for high income
    midpoint = 45000,          # Adjust based on your data range
    labels = scales::dollar_format(),
    name = "Median Income"
  ) +
  theme_minimal(base_size = 14, base_family = "sans") +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5, face = "italic"),
    plot.caption = element_text(size = 10, hjust = 0.5, face = "italic"),
    legend.title = element_text(face = "bold", size = 12),
    legend.text = element_text(size = 10),
    legend.position = "right",
    panel.grid = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank()
  ) +
  labs(
    title = "Median Income for Black Americans by State",
    subtitle = "State-level median household income for Black residents",
    caption = "Data Source: Black Wealth Data Center calculations from U.S. Census Bureau, 2023"
  )

black_income_map
```


